<%# Posts Index Page %>
<% content_for :title, "All Posts" %>

<div class="container-fluid py-4">
  <!-- Header Section -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h1 class="h2 text-dark mb-1">
            <i class="fas fa-blog me-2 text-primary"></i>
            All Posts
          </h1>
          <p class="text-muted mb-0">Discover amazing content from our community</p>
        </div>
        <div class="d-flex gap-2">
          <% if user_signed_in? %>
            <%= link_to new_post_path, class: "btn btn-primary" do %>
              <i class="fas fa-plus me-1"></i>
              New Post
            <% end %>
            <%= link_to my_posts_posts_path, class: "btn btn-outline-primary" do %>
              <i class="fas fa-user-edit me-1"></i>
              My Posts
            <% end %>
          <% else %>
            <%= link_to new_user_session_path, class: "btn btn-primary" do %>
              <i class="fas fa-sign-in-alt me-1"></i>
              Sign In to Write
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Search Section -->
  <div class="row mb-4">
    <div class="col-12 col-md-8 mx-auto">
      <%= search_form_for @q, url: posts_path, method: :get, class: "d-flex" do |f| %>
        <div class="input-group">
          <%= f.search_field :title_cont, 
                placeholder: "Search posts...", 
                class: "form-control form-control-lg",
                value: params.dig(:q, :title_cont) %>
          <button class="btn btn-outline-secondary" type="submit">
            <i class="fas fa-search"></i>
          </button>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Posts Grid -->
  <div class="row">
    <% if @posts.any? %>
      <% @posts.each do |post| %>
        <div class="col-12 col-md-6 col-lg-4 mb-4">
          <div class="card h-100 shadow-sm hover-shadow transition-all">
            <div class="card-body d-flex flex-column">
              <!-- Post Header -->
              <div class="d-flex justify-content-between align-items-start mb-3">
                <div class="d-flex align-items-center">
                  <div class="avatar-sm me-2">
                    <%= image_tag post.user.avatar_url(:small), 
                          class: "rounded-circle", 
                          style: "width: 40px; height: 40px; object-fit: cover;" %>
                  </div>
                  <div>
                    <h6 class="mb-0 text-dark"><%= post.user.full_name %></h6>
                    <small class="text-muted"><%= post.formatted_created_at %></small>
                  </div>
                </div>
                <span class="badge bg-success">
                  <i class="fas fa-eye me-1"></i>
                  Published
                </span>
              </div>

              <!-- Post Content -->
              <div class="flex-grow-1">
                <h5 class="card-title mb-2">
                  <%= link_to post.title, post_path(post), 
                        class: "text-decoration-none text-dark hover-primary" %>
                </h5>
                <p class="card-text text-muted mb-3">
                  <%= post.excerpt(120) %>
                </p>
              </div>

              <!-- Post Footer -->
              <div class="d-flex justify-content-between align-items-center">
                <small class="text-muted">
                  <i class="fas fa-clock me-1"></i>
                  <%= post.reading_time %>
                </small>
                <%= link_to "Read More", post_path(post), 
                      class: "btn btn-sm btn-outline-primary" %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    <% else %>
      <!-- Empty State -->
      <div class="col-12">
        <div class="text-center py-5">
          <div class="mb-4">
            <i class="fas fa-blog fa-4x text-muted"></i>
          </div>
          <h3 class="text-muted mb-3">No Posts Found</h3>
          <p class="text-muted mb-4">
            <% if params.dig(:q, :title_cont).present? %>
              No posts match your search criteria. Try different keywords.
            <% else %>
              Be the first to share something amazing with the community!
            <% end %>
          </p>
          <% if user_signed_in? %>
            <%= link_to "Write First Post", new_post_path, 
                  class: "btn btn-primary btn-lg" %>
          <% else %>
            <%= link_to "Sign Up to Write", new_user_registration_path, 
                  class: "btn btn-primary btn-lg" %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

  <!-- Pagination -->
  <% if @posts.respond_to?(:current_page) %>
    <div class="row mt-4">
      <div class="col-12">
        <div class="d-flex justify-content-center">
          <%= paginate @posts, theme: 'twitter-bootstrap-4' %>
        </div>
      </div>
    </div>
  <% end %>
</div>

<!-- Custom CSS -->
<style>
  .hover-shadow {
    transition: box-shadow 0.3s ease;
  }
  
  .hover-shadow:hover {
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
  }
  
  .transition-all {
    transition: all 0.3s ease;
  }
  
  .hover-primary:hover {
    color: #0d6efd !important;
  }
  
  .avatar-sm {
    flex-shrink: 0;
  }
  
  .card {
    border: none;
    border-radius: 12px;
  }
  
  .btn-outline-primary:hover {
    transform: translateY(-1px);
  }
</style>
